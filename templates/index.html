<html>
    <head>
        <meta charset="UTF-8" content="">
        <title>Система управления UPS 1600</title>
        <link rel="shortcut icon" href="{{url_for('static',filename='MSlogo_44.ico')}}">
        <link rel="stylesheet" href="{{url_for('static',filename='css/index.css')}}">
        <script defer src="{{url_for('static',filename='scripts/jquery.js')}}" type="text/javascript"></script>
        <script defer src="{{url_for('static',filename='scripts/jquery.inputmask.js')}}" type="text/javascript"></script>
        <script defer src="{{url_for('static',filename='scripts/Chart.bundle.min.js')}}" type="text/javascript"></script>
        <script defer src="{{url_for('static',filename='scripts/moment.min.js')}}" type="text/javascript"></script>
        <script defer src="{{url_for('static',filename='scripts/index.js')}}" type="text/javascript"></script>
    </head>
    <body id="body">
        <div class="header">
            <img src="{{url_for('static',filename='MSlogo_44.ico')}}" alt="" style="padding: 0; margin: 0 0 0 5px; width: 5vh; height: 5vh;">
            <h2>MLink - UPS 1600 - Система мониторинга</h2>
<!--            <div class="header-right">-->
<!--                <a href=logout><button class="btn_exit">Выход</button></a>-->
<!--            </div>-->
        </div>
        <div class="main" id="main">
            <div class="main-buttons">
                <a href="#information" style="width: 100%;" onclick="return show_fieldset('0')" id="ah_0"><button class="btn_menu" id="btn_0">Состояние</button></a>
                <a href="#logs" style="width: 100%;" onclick="return show_fieldset('1')" id="ah_1"><button class="btn_menu" id="btn_1">Журнал</button></a>
                <a href="#settings" style="width: 100%;" onclick="return show_fieldset('2')" id="ah_2"><button class="btn_menu" id="btn_2">Уставки</button></a>
<!--                <a href="#update" style="width: 100%;" onclick="return show_fieldset('3')" id="ah_3"><button class="btn_menu" id="btn_3">Обновление</button></a>-->
            </div>
            <div class="main-base" id="main-base" style="padding: 0 1.38vh;">
                <fieldset class="base-fieldset" style="z-index: 100; flex-direction: column; flex-wrap: wrap; justify-content: flex-start;" id="fs_0">
<!--                    background:url({{url_for('static',filename='images/web_bkg.png')}}) no-repeat;width:90%;height:90%;-->
                    <legend style="text-align: left;">Состояние</legend>
                    <div class="left">
                        <fieldset class="status">
                            <legend style="text-align: left; font-size: 2vh;">Режим работы</legend>
                            <div id="err_sts" style="font-size: 3vh;"></div>
                        </fieldset>
                        <div class="pcs">
                            <fieldset class="pcs-fieldset" style="flex-direction: column; flex-wrap: wrap; justify-content: flex-start;" id="pcs_0">
                                <legend style="text-align: left; font-size: 2vh;">БВ 1 - Фаза А</legend>
                                <fieldset class="led_status" id="bv1_status"></fieldset>
                                <div class="current_pcs" id="ua">0 B</div>
                                <div class="current_pcs" id="tinv1">0 &deg;С</div>
                                <div class="current_pcs" id="iinv1">0 A</div>
                            </fieldset>
                            <fieldset class="pcs-fieldset" style="flex-direction: column; flex-wrap: wrap; justify-content: flex-start;" id="pcs_1">
                                <legend style="text-align: left; font-size: 2vh;">БВ 2 - Фаза В</legend>
                                <fieldset class="led_status" id="bv2_status"></fieldset>
                                <div class="current_pcs" id="ub">0 B</div>
                                <div class="current_pcs" id="tinv2">0 &deg;С</div>
                                <div class="current_pcs" id="iinv2">0 A</div>
                            </fieldset>
                            <fieldset class="pcs-fieldset" style="flex-direction: column; flex-wrap: wrap; justify-content: flex-start;" id="pcs_2">
                                <legend style="text-align: left; font-size: 2vh;">БВ 3 - Фаза С</legend>
                                <fieldset class="led_status" id="bv3_status"></fieldset>
                                <div class="current_pcs" id="uc">0 B</div>
                                <div class="current_pcs" id="tinv3">0 &deg;С</div>
                                <div class="current_pcs" id="iinv3">0 A</div>
                            </fieldset>
                        </div>
                        <div class="pcs">
<!--                            <fieldset class="pcs-fieldset" style="flex-direction: column; flex-wrap: wrap; justify-content: flex-start;" id="t_1">-->
                            <fieldset class="akb-fieldset" style="flex-direction: column; flex-wrap: wrap; justify-content: flex-start;" id="t_1">
                                <legend style="text-align: left; font-size: 2vh;">Температура на АКБ</legend>
                                <div class="current" id="temp_akb" style="padding: 2vh;">0 &deg;С</div>
                            </fieldset>
<!--                            <fieldset class="pcs-fieldset" style="flex-direction: column; flex-wrap: wrap; justify-content: flex-start;" id="t_2">-->
                            <fieldset class="akb-fieldset" style="flex-direction: column; flex-wrap: wrap; justify-content: flex-start;" id="t_2">
                                <legend style="text-align: left; font-size: 2vh;">Температура в шкафу</legend>
                                <div class="current" id="temp_air" style="padding: 2vh;">0 &deg;С</div>
                            </fieldset>
<!--                            <fieldset class="pcs-fieldset" style="flex-direction: column; flex-wrap: wrap; justify-content: flex-start;" id="t_3">-->
<!--                                <legend style="text-align: left; font-size: 2vh;">Температура CPU</legend>-->
<!--                                <div class="current" id="temp_cpu" style="padding: 2vh;">0 &deg;С</div>-->
<!--                            </fieldset>-->
                        </div>
                        <div class="akb">
                            <fieldset class="akb-fieldset" style="flex-direction: column; flex-wrap: wrap; justify-content: flex-start;" id="iakb">
                                <legend style="text-align: left; font-size: 2vh;">Ток АКБ ("-" - заряд АКБ, "+" - разряд АКБ)</legend>
                                <div class="current" id="iakb1" style="padding: 2vh;">0 A</div>
                            </fieldset>
                            <fieldset class="akb-fieldset" style="flex-direction: column; flex-wrap: wrap; justify-content: flex-start;" id="i_load">
                                <legend style="text-align: left; font-size: 2vh;">Ток нагрузки</legend>
                                <div class="current" id="iload" style="padding: 2vh;">0 A</div>
                            </fieldset>
                        </div>
                        <div class="akb">
                            <fieldset class="akb-fieldset" style="flex-direction: column; flex-wrap: wrap; justify-content: flex-start;" id="akb1">
                                <legend style="text-align: left; font-size: 2vh;">Напряжение на первом блоке АКБ</legend>
                                <div class="current" id="uakb1" style="padding: 2vh;">0 В</div>
                            </fieldset>
                            <fieldset class="akb-fieldset" style="flex-direction: column; flex-wrap: wrap; justify-content: flex-start;" id="akb2">
                                <legend style="text-align: left; font-size: 2vh;">Напряжение на втором блоке АКБ</legend>
                                <div class="current" id="uakb2" style="padding: 2vh;">0 В</div>
                            </fieldset>
                        </div>
                        <div class="akb">
                            <fieldset class="akb-fieldset" style="flex-direction: column; flex-wrap: wrap; justify-content: flex-start;" id="akb3">
                                <legend style="text-align: left; font-size: 2vh;">Напряжение на третьем блоке АКБ</legend>
                                <div class="current" id="uakb3" style="padding: 2vh;">0 В</div>
                            </fieldset>
                            <fieldset class="akb-fieldset" style="flex-direction: column; flex-wrap: wrap; justify-content: flex-start;" id="akb4">
                                <legend style="text-align: left; font-size: 2vh;">Напряжение на четвертом блоке АКБ</legend>
                                <div class="current" id="uakb4" style="padding: 2vh;">0 В</div>
                            </fieldset>
                        </div>
                    </div>
                    <div class="right">
                        <div class="u_load">
                            <fieldset class="u_load_f">
                                <legend style="text-align: left; font-size: 1.8vh;">Управляющее напряжение</legend>
                                <div id="u_bv" style="font-size: 3vh;">0 В</div>
                            </fieldset>
                            <fieldset class="u_load_f">
                                <legend style="text-align: left; font-size: 1.8vh;">Напряжение нагрузки</legend>
                                <div id="uload" style="font-size: 3vh;">0 B</div>
                            </fieldset>
                        </div>
                        <fieldset class="dry_in-fieldset">
                            <legend style="text-align: left; font-size: 2vh;">Входные сухие контакты</legend>
                            <fieldset class="led_status" id="dry1_in">1</fieldset>
                            <fieldset class="led_status" id="dry2_in">2</fieldset>
                            <fieldset class="led_status" id="dry3_in">3</fieldset>
                            <fieldset class="led_status" id="dry4_in">4</fieldset>
                        </fieldset>
                        <fieldset class="dry_out-fieldset">
                            <legend style="text-align: left; font-size: 2vh;">Выходные сухие контакты</legend>
                            <fieldset class="led_status" id="dry1_out">1</fieldset>
                            <fieldset class="led_status" id="dry2_out">2</fieldset>
                            <fieldset class="led_status" id="dry3_out">3</fieldset>
                            <fieldset class="led_status" id="dry4_out">4</fieldset>
                        </fieldset>
                        <fieldset class="dry_out-fieldset" style="height: 36.4vh;">
                            <legend style="text-align: left; font-size: 2vh;">График напряжений</legend>
                            <canvas id="myChart" style="width:100%; height: 35vh;"></canvas>
                        </fieldset>
<!--                        <fieldset class="dry_out-fieldset">-->
<!--                            <legend style="text-align: left; font-size: 2vh;">Длительность последнего заряда АКБ</legend>-->
<!--                            <div class="current" id="t_charge_mode" style="padding: 2vh;">0:00:00.0</div>-->
<!--                        </fieldset>-->
                    </div>
                </fieldset>
                <fieldset class="base-fieldset" style="visibility: hidden;" id="fs_1">
                    <legend style="text-align: left;">Журнал</legend>
                    <div style="overflow: auto; height: 74vh; width: 100%;" id="journal"></div>
                </fieldset>
                <fieldset class="base-fieldset" style="visibility: hidden; flex-direction: column; flex-wrap: wrap; justify-content: flex-start;" id="fs_2">
                    <legend style="text-align: left;">Уставки</legend>
                    <fieldset style="width: 80vh;">
                        <legend style="text-align: left; font-size: 2.5vh;">Сеть</legend>
                        <div class="new_sub">IP адрес:<input id="ip_addr" type="text" placeholder="xxx.xxx.xxx.xxx" onfocusin="rem(this)" onfocusout="check_input_ip(this)"></div>
                        <div class="new_sub">Маска сети:<input id="ip_mask" type="text" placeholder="xxx.xxx.xxx.xxx" onfocusin="rem(this)" onfocusout="check_input_ip(this)"></div>
                        <div class="new_sub">Шлюз:<input id="ip_gate" type="text" placeholder="xxx.xxx.xxx.xxx" onfocusin="rem(this)" onfocusout="check_input_ip(this)"></div>
                        <div class="new_sub">MAC адрес:<input id="ip_mac" type="text" readonly></div>
<!--                        <div><img class="pid_key_small" src="{{url_for('static',filename='images/buttons/ip_set.png')}}" alt="Изменить ip" style="width: 5vh; height: 5vh;"></div>-->
<!--                        onclick="return new_ip.init();"-->
                    </fieldset>
                    <fieldset style="width: 80vh;">
                        <legend style="text-align: left; font-size: 2.5vh;">UPS 1600</legend>
<!--                        onfocusout="check_input(this)"-->
                        <div class="new_sub">Глубина разряда АКБ при наличии входного напряжения<input id="discharge_depth" type="text" placeholder="x0%" onfocusout="check_input(this)"></div>
                        <div class="new_sub">Максимальный ток нагрузки – ток отсечки<input id="i_load_max" type="text" placeholder="xxA" onfocusout="check_input(this)"></div>
                        <div class="new_sub">Емкость АКБ<input id="q_akb" type="text" placeholder="xxxA&#183;ч" onfocusout="check_input(this)"></div>
                        <div class="new_sub">Напряжение на выходе ИБП в случае работы без АКБ<input id="u_abc_max" type="text" placeholder="xxВ" onfocusout="check_input(this)"></div>
                        <div class="new_sub">Максимальная температура в шкафу<input id="max_temp_air" type="text" placeholder="xx&deg;С" onfocusout="check_input(this)"></div>
<!--                        <div class="new_sub">Глубина разряда АКБ при отсутствии входного напряжения<input id="discharge_akb" type="text" placeholder="xx%"></div>-->
<!--                        <div class="new_sub">Время задержки срабатывания защиты при превышении тока нагрузки-->
<!--                            <select name="t_delay" id="t_delay" onchange="">-->
<!--                                  <option value='0'>1 мс</option>-->
<!--                                  <option value='10'>10 мс</option>-->
<!--                                  <option value='50'>50 мс</option>-->
<!--                                  <option selected value='100'>100 мс</option>-->
<!--                                  <option value='200'>200 мс</option>-->
<!--                                  <option value='500'>500 мс</option>-->
<!--                            </select>-->
<!--                        </div>-->
<!--                        <div class="new_sub">Значение максимального тока заряда АКБ<input id="i_charge_max" type="text"></div>-->
                    </fieldset>
                    <fieldset style="width: 80vh;">
                        <legend style="text-align: left; font-size: 2.5vh;">Дата и время</legend>
                        <div class="new_sub">Дата и время UTC<input type="datetime-local" id="utctime" min="2023-01-01 00:00" onfocusout="send_time(this)"></div>
                        <div class="new_sub">Часовой пояс
                            <select name="time_zone" id="time_zone" onchange="send_tz(this)">
                                  <option value=0>0 ч</option>
                                  <option value=1>+1 ч</option>
                                  <option value=2>+2 ч</option>
                                  <option selected value=3>+3 ч</option>
                                  <option value=4>+4 ч</option>
                                  <option value=5>+5 ч</option>
                                  <option value=6>+6 ч</option>
                                  <option value=7>+7 ч</option>
                                  <option value=8>+8 ч</option>
                                  <option value=9>+9 ч</option>
                                  <option value=10>+10 ч</option>
                                  <option value=11>+11 ч</option>
                            </select>
                        </div>
                    </fieldset>
                    <button id="btn_reboot" style="visibility: hidden; width: 15%; margin: 1vh; font-size: 2vh; background: #f33;" onclick="return reboot_pc()">Перезагрузить</button>
                </fieldset>
                <fieldset class="base-fieldset" style="visibility: hidden; flex-direction: column; flex-wrap: wrap; justify-content: flex-start;" id="fs_3">
                    <legend style="text-align: left;">Обновление</legend>
                    <fieldset style="width: 80vh;">
                        <legend style="text-align: left; font-size: 2.5vh;">ARM</legend>
                        <label class="input-file">
                            <span style="font-size: 3vh;">Выберите .bin файл: <input type="file" id="fileUpload" accept=".bin,.txt"></span>
                        </label>
                        <button id="update_arm" style="visibility: hidden;" onclick="return stm32loader()">Обновить</button>
                    </fieldset>
                </fieldset>
            </div>
        </div>
        <div class="footer">
            <p id="version">Микролинк-связь ООО &copy; &reg;, 2023</p>
<!--            <fieldset class="ping_status" id="led_status" style="font-size: 2vh;"></fieldset>-->
<!--            <a href=logout><button class="btn_exit">Выход</button></a>-->
            <div id="current-date" style="padding: 0;"></div>
        </div>
    </body>
</html>